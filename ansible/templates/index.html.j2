<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{{ site_name }}</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link href="/css/ndt_d3.css" rel="stylesheet" />
    <link href="/css/jquery-ui-slider-pips.css" rel="stylesheet" />
    <link href="/css/jquery-ui.min.css" rel="stylesheet" />
    <link href="/css/mlab.css" rel="stylesheet" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-40979426-10"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() { dataLayer.push(arguments); }
      gtag('js', new Date());

      gtag('config', 'UA-40979426-10');
    </script>

    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="/js/mlab.js"></script>
    <script src="/js/ndt.js"></script>
    <script src="/js/ndt_d3.js"></script>
    <script src="/js/d3.v3.min.js"></script>
    <script src="/js/center.js"></script>
    <script src="/js/jquery-ui.min.js"></script>
    <script src="/js/jquery-ui-slider-pips.min.js"></script>
  </head>

<body>

  <div id="spinner">
    <div id="spin">&nbsp;</div>
    <div id="loading">LOADING</div>
  </div>

  <div id="welcome-container" role="main">
    <img src="/images/michigan_moonshot_speedtest_header_small.jpg" alt="The Michigan Moonshot" class="banner">
    <div class="logos">
      <img src="/images/Michigan_State_University_logo_green.png" alt="Michigan State University logo" class="msu-logo" />
      <img src="/images/quello-logo.png" alt="Quello Logo" class="quello-logo" />
      <img src="/images/merit-logo.png" alt="Merit Network Logo" class="merit-logo" />
      <img src="/images/mlab-logo.png" alt="mLab Logo" class="mlab-logo" />
    </div>

    <div id="header">
      <div id="intro">

        <p>
          The Michigan Moonshot is a statewide broadband initiative run by Merit Network, a non-profit research and education network, in partnership with the
          Quello Center at Michigan State University. The goal of this survey is to identify areas of Michigan that do not have broadband Internet, or have poor
          broadband Internet service. While Merit is not a residential broadband service provider, information gathered from this survey will help us foster
          collaboration within Michigan to improve broadband connectivity for communities.
        </p>

        <p>
          Your response is critical to these efforts and completing this survey should take five minutes, or less. Any information submitted will not be sold,
          but may be used in planning to expand access opportunities with government and local partners as outlined in the Data Privacy FAQ below. We understand
          that you may not have all the necessary information to answer each question on this survey, please answer to the best of your ability.
        </p>

        <p>
          You must be 13 years or older or have your parents' consent to participate in the survey.
        </p>

        <div class="panel panel-default">
          <div class="panel-body text-center">
            <p>
              <strong>
                Please participate from your home or business network connection. This survey is designed for homes and
                businesses with Internet connectivity. If you do not have Internet access at your location, please complete the
                <a href="https://umich.qualtrics.com/jfe/form/SV_0Bazv1u1p17Tgu9">Unserved Michigan Moonshot Survey</a>.
              </strong>
            </p>

            <h3>For questions concerning this survey please contact:</h3>
            <h4><a href="mailto:moonshotcontact@merit.edu">moonshotcontact@merit.edu</a></h4>
            <h5><a href="tel:+7345275733">(734) 527-5733</a></h5>
          </div>
        </div>
      </div>
    </div>

    <div id="about-merit-network" class="about">
      <details>
        <summary>About Merit Network</summary>

        <p>
          Merit Network, Inc. is a nonprofit organization governed by Michigan’s
          public universities. Merit owns and operates America’s longest-running
          regional research and education network. In 1966, Michigan’s public
          universities created Merit as a shared resource to help meet their
          common need for networking assistance. Since its formation, Merit
          Network has remained on the forefront of research and education
          networking expertise and services. Merit provides high-performance
          networking, cybersecurity and community services to Michigan’s public
          universities, colleges, K-12 organizations, libraries, state government,
          healthcare, and other non-profit organizations.
        </p>
      </details>
    </div>

    <div id="about-quello-center" class="about">
      <details>
        <summary>About the Quello Center at Michigan State University</summary>

        <p>
          The Quello Center is a multi-disciplinary research center affiliated
          with the Department of Media and Information at Michigan State
          University. The Center seeks to stimulate and inform debate on the
          economic and social implications of media, communication, and
          information innovations in the digital age.
        </p>
      </details>
    </div>

    <div id="about-mlab" class="about">
      <details>
        <summary>About Measurement Lab (M-Lab)</summary>
        <p>
          The Measurement Lab (M-Lab) platform is run by the scientific
          community. We make all test results publicly available via the
          <a href="https://www.measurementlab.net/" target="_blank" rel="noopener noreferrer">MeasurementLab.net</a>
          website to help promote Internet research. M-Lab's Network Diagnostic
          Tool collects a number of measures of different facets of your
          Internet connection. The information published includes each device’s
          IP address, but does not include personal identifying information
          about you as an Internet user.
        </p>
      </details>
    </div>

    <div id="about-moonshot" class="about">
      <details>
        <summary>About the Michigan Moonshot</summary>
        <p>
          The Michigan Moonshot is a collective call to action which aims to
          bridge the digital divide in Michigan. Stakeholders include Merit
          Network, the nation’s longest-running research and education network,
          the Quello Center at Michigan State University and M-Lab, the largest
          open Internet measurement platform in the world. This initiative aims
          to expand broadband access to all citizens through policy and funding,
          data and mapping, education and resources. Learn more about the
          Michigan Moonshot at <a href="https://www.merit.edu/services/moonshot/">Merit.edu/moonshot</a>.
        </p>
      </details>
    </div>

    <div id="faq" class="about">
      <details>
        <summary>Data Privacy FAQ</summary>
        <h3>Who Is Involved</h3>
        <p>
          There are several groups of individuals who are involved with this initiative: Merit Network, Inc. is a non-profit organization performing data
          collection and analysis around broadband data speeds, availability, and impact on our communities.
          The sponsor is the group or organization which has contracted with Merit to perform this work, and will receive the aggregate reports and output from
          the analysis once completed. Sponsors can be municipal or other civic organizations which want to understand how broadband data exists and impacts the
          communities they serve. Participants are residents of these communities, and provide the data which is used for analysis.
        </p>

        <h3>Data We Collect</h3>
        <p>
          We collect data from several public and non-public sources in order to perform this service. Data that is not considered public data comes directly
          from participants, and includes both individualized survey responses and an associated broadband speed measurement test. Survey responses can include
          local addresses and property parcel IDs along with participant-generated responses to how a household manages and uses any Internet service. Data is
          not specifically tied to an individual, but to a home, property, or residence within a geographical area.
        </p>

        <h3>What We Do With Data</h3>
        <p>
          Public and participant-provided data is aggregated and analyzed to report on broadband availability within census block units of a geographic area.
          Graphs, maps, and tabular reports are generated to display census-level blocks corresponding with adoption of Internet Service Providers (ISPs),
          average broadband usage, and other aggregated data resulting from participant-driven surveys.
        </p>

        <p>
          Broadband speed testing data is gathered via the Measurement Lab (M-Lab) platform, and is run by the scientific community. All test results are
          publicly available via the MeasurementLab.net website to help promote Internet research, as M-Lab's Network Diagnostic Tool collects a number of
          measures of different facets of Internet connections. The information published includes each device’s IP address, but does not include personal
          identifying information about specific Internet users.
        </p>

        <h3>What Others Can Do With Data</h3>
        <p>
          Only certain data provided by Merit to sponsors may be shared with any other parties. Summary reports, broadband speed test data, and associated
          geographic maps may be used in reports, presentations, and other forms of communication to showcase the current state of broadband access in a
          sponsor's community. In all other cases, data may not be sold, transferred, or shared with any other third parties without the express written consent
          of Merit Network, Inc. Data may not be used by non-public Internet Service Providers (ISPs) to segregate areas of investment or divestment within
          communities. Sponsors must treat any data with the same level of care as their own internal, confidential data.
        </p>

        <h3>Data Storage</h3>

        <p>
          Collected data is stored in a third-party platform (Google BigQuery) for research and analysis, with aggregate reporting data compiled and stored on
          secured systems at Merit Network. Data is kept encrypted at rest and in transit where technically possible and kept within the United States.
        </p>
        <p>
          Aggregate and report data is provided to the sponsor as a deliverable of this service. Data may be retained indefinitely by Merit Network in order to
          assist with longitudinal studies with the express purpose of assisting municipalities, governments, and other organizations with increasing broadband
          deployment and usage within the United States.
        </p>

        <h3>Data Confidentiality</h3>

        <p>
          All data collected and created is treated with the same level of data classification as Merit's own internal data, and subsequently with the same
          level of protections and security controls as well. Data may only be viewed by individuals performing work on the data, and access is restricted to
          the minimum amount of access necessary to perform work. Oversight of privacy and security controls surrounding this data is performed by the Chief
          Information Security Officer (CISO) at Merit Network.
        </p>

        <h3>How will my data be shared?</h3>

        <p>
          The Measurement Lab (M-Lab) platform is run by the scientific community. M-Lab
          makes all test results publicly available via the <a href="https://www.measurementlab.net/" target="_blank"
            rel="noopener noreferrer">MeasurementLab.net</a>
          website to help promote Internet research. M-Lab's Network Diagnostic Tool collects a number of measures of
          different facets of your Internet connection. The information published includes each device’s IP
          address, but does not include personal identifying information about you as an Internet user.
        </p>

        <h3>How will my information be secured?</h3>
        <p>
          Merit Network will be responsible for data management related to this
          project. Data will be maintained and archived in a secure and
          password-protected repository. All data will be made available in a
          format that protects anonymity and confidentiality.
        </p>

        <h3>How does the Broadband Speed Test work?</h3>
        <p>
          The Michigan Broadband Speed Test utilizes the open source test and servers provided by
          Measurement Lab (M-Lab), a consortium of public interest groups, academic institutions and
          industry partners, providing an open platform dedicated to Internet performance measurement.
          When you start a test, your browser opens a connection to the closest M-Lab server. It then
          exchanges with the server a synthetic stream of data, generated solely for the purpose of
          measuring your connection at that time. During the test, the server collects around 100 low-level
          metrics. When the test is completed, the user is shown three of the most accessible
          measurements: download speed, upload speed, and minimum round trip time.
        </p>

        <h3>Why does this test show different results than other tests like speedtest.net?</h3>
        <p>
          Different network measurement tests sometimes show variance in results due to factors such as
          the methodology of the test. Both <a href="https://www.speedtest.net/" target="_blank" rel="noopener noreferrer">speedtest.net</a> and
          M-Lab's tests are valid measurements but have different methods and instrumentation which
          account for the difference in measurements.
        </p>

        <p>
          In both M-Lab's NDT test and Ookla's speedtest.net test, there is a client and a server component.
          The client is the test running in your browser in both cases. Ookla's servers are always within the
          ISP's last mile network, while M-Lab's servers are always in transit data centers, outside of any
          ISP last mile network.
        </p>

        <p>
          The <a href="https://www.speedtest.net/" target="_blank" rel="noopener noreferrer">speedtest.net</a> test is an on-net measurement of your
          connection's performance to the edge of
          your ISP's network, and M-Lab's test is an off-net measurement of your connection's
          performance through your ISP's network to one of M-Lab's servers in a Seattle Internet exchangepoint. M-Lab's methodology is based on the rationale
          that consumers request content from the
          Internet which could be anywhere in the world, most of which is outside their ISP's network. By
          tracing the performance over the full path of your broadband connection to the global
          Internet, M-Lab measures the performance of your connection across interconnected networks,
          which is closer to the way you access the Internet everyday.
        </p>

        <h3>Why do internet performance tests provide different results?</h3>
        <p>
          Three of the main reasons for different results among tests are listed
          below:
        </p>

        <ol>
          <li>
            <p>Differences in the location of testing servers</p>
            <p>Every performance test has two parts:</p>
            <ul>
              <li><strong>Client</strong>: This is the software that runs on the user’s machine and shows the user their speed results.</li>
              <li><strong>Server</strong>: This is the computer on the Internet to which the client connects to complete the test.</li>
            </ul>

            <p>
              A test generates data between the client and the server, and measures performance
              between these two points. The location of these two points is important in terms of
              understanding the results of a given test. If the server is located within your Internet
              Service Provider’s (ISP’s) own network (also known as the “last mile”), this is referred to
              as an <em>“on-net”</em> measurement. This approach lets you know how your Internet
              connection is performing intra-network within your ISP, but it does not necessarily
              reflect the full experience of using the Internet, which almost always involves using inter-
              network connections (connections between networks) to access content and services that
              are hosted somewhere outside of your ISP. Results from on-net testing are often higher
              than those achieved by using other methods, since the “distance” traveled is generally
              shorter, and the network is entirely controlled by one provider (your ISP). <em>“Off-net”</em>
              measurements occur between your computer and a server located outside of your
              ISP’s network. This means that traffic crosses inter-network borders and often travels
              longer distances. Off-net testing frequently produces results that are lower than those
              produced from on-net testing. M-Lab’s measurements are always conducted off-net. This
              way, M-Lab is able to measure performance from testers’ computers to locations where
              popular Internet content is often hosted. By having inter-network connections included in
              the test, test users get a real sense of the performance they could expect when using the
              Internet.
            </p>
          </li>

          <li>
            <p>Differences in testing methods</p>

            <p>
              Different Internet performance tests measure different things in different ways. M-Lab’s
              NDT test tries to transfer as much data as it can in ten seconds (both up and down), using
              a single connection to an M-Lab server. Other popular tests try to transfer as much data
              as possible at once across multiple connections to their server. Neither method is
              “right”or “wrong,” but using a single stream is more likely to help diagnose problems in the
              network than multiple streams would. All NDT data collected by M-Lab are publicly
              available in both visualized (graphic), queryable, and raw (unanalyzed) forms. Learn
              more about M-Lab’s NDT <a href="https://www.measurementlab.net/tests/ndt/" target="_blank" rel="noopener noreferrer">methodology</a>.
            </p>
          </li>

          <li>
            <p>Changing network conditions and distinct test paths</p>
            <p>
              The Internet is always changing, and test results reflect that. A test conducted five minutes ago
              may show very different results from a test conducted twenty minutes ago. This can be caused by
              the test traffic being routed differently. For example, one test might travel over a path with a
              broken router, while another may not. A test run today may be directed to a test server located
              farther away than a test run yesterday. Additionally, IPv4 and IPv6 routes may take different
              physical paths. Some IPv6 routes may be tunneled through IPv4, from the client, or at any point
              after the client depending on local network management. In short, running one test will give you
              a sense of network conditions at that moment, across the best network path available at that time,
              to the specific server coordinating the test. But because Internet routing and infrastructure change
              dynamically, testing regularly and looking at the data over time are much more reliable ways to
              gauge representative performance.
            </p>
        </ol>

        <h3>What data does this test collect, and how will it be used?</h3>
        <p>
          Before you take the test, you will be asked for your location and some basic information about
          your connection. This data will be stored in a private database, combined with other results,
          and published to the map in anonymized form.
        </p>

        <p>
          This test does not collect information about your other Internet traffic, such as your emails, web
          searches, etc., or any personally identifiable information. The data it sends across your network
          is synthetic - meaning it does not come from your device or other applications you are operating
          - and will be used for measurement only. The speed test data is submitted to M-Lab in
          aggregated form to assure that the anonymity of users is protected.
        </p>

        <h3>What do these results mean?</h3>
        <p>
          Your speed test results show the actual upload and download speeds you are experiencing at the
          time you take the test. Results can vary due to the device you are using, your operating system,
          the browser you use, the time of day you take the test, whether you are using WiFi or a wired
          connection, the number of devices connected to the same signal at once, and many other factors.
          You can take this test as many times as you like, from as many devices and locations as you like.
          If the speeds you are receiving do not match up to your expectations, you have a number of
          options.
        </p>
      </details>
    </div>

    <div id="sidebar">
      <form action="/collector/collect" method="get" id="collector">
        <div id="extra-data" class="ndt-related">
          <div class="container" id="all-form-fields">
            {% for item, field in form_fields.items() -%}
              {% for attr, vals in field.items() -%}
              <div class="form-field" id="container-{{ vals['id'] }}">
                <div class="field-container">
                  <label for="{{ vals['id'] }}">{{ vals['text'] }}</label>
                </div>
                <div class="field-container">
                  {% if vals['field_type'] == 'select_list' -%}
                  <select id="{{ vals['id'] }}" name="{{ vals['name'] }}" class="form-control {{ vals['class'] }}" title="{{ vals['title'] }}">
                    {% for opt, item in vals.options.items() | sort -%}
                      <option value="{{ opt }}" {% if opt == 'default' %}selected{% endif %}>{{ item }}</option>
                    {%- endfor -%}
                  </select>
                  {% elif vals['field_type'] == 'text' -%}
                    <input id="{{ vals['id'] }}" type="text" name="{{ vals['name'] }}"
                      class="form-control {{ vals['class'] }}" {% if vals['size'] is defined %} size="{{ vals['size'] }}" {% endif %} title="{{ vals['title'] }}" />
                  {% elif vals['field_type'] == 'checkbox' %}
                    {% for opt, item in vals.options.items() | sort -%}
                      <input type="checkbox" value="{{ vals['id'] }}[{{ opt }}]" {% if opt == 'default' %}selected{% endif %}>{{ item }}</input>
                    {%- endfor -%}
                  {% endif -%}
                </div>
              </div>
              {% endfor -%}
            {% endfor -%}
          </div>

          <div class="container" id="consent-text">
            <label>
              <span class="required">*</span> <input type="checkbox" name="data_acknowledgement" id="data_acknowledgement" value="yes" />
              <span>{{ consent_message }}</span>
            </label>
            <ul>
              <li class="text-muted">Providing your exact street address will help improve the accuracy of the data. Per our privacy policy, any information
                will be treated confidentially.</li>
              <li class="text-muted">By providing your email address, you may be contacted later regarding future optional studies.</li>
            </ul>
          </div>

          <input name="latitude" id="latitude" type="hidden" />
          <input name="longitude" id="longitude" type="hidden" />
          <input name="actual_download" id="actual_download" type="hidden" />
          <input name="actual_upload" id="actual_upload" type="hidden" />
          <input name="min_rtt" id="min_rtt" type="hidden" />
          <input name="bigquery_key" id="bigquery_key" type="hidden" />
        </div>
        <div id="test-container">
          <div class="row">
            <div class="col-md-8 col-md-offset-2">
              <div id="ndt-div">
                <div id="ndt-svg"></div>
              </div>
              <div id="ndt-status"></div>
            </div>
          </div>

          <div class="row">
            <div class="col-sm-6 col-sm-offset-3">
              <div id="approx-loc">
                <div>
                  <h3 class="league-gothic">{{ run_test_heading }}</h3>
                  <h4>Hit the "play" button to begin the speed test.</h4>
                </div>

                <div class="well">
                  <p>
                    Internet infrastructure and citizens’ use of it is
                    ever-evolving. A test conducted today may show different
                    results than a test conducted last week. This can be caused
                    by changes in equipment, the number of people using the
                    network simultaneously and the services people use on the
                    Internet. We encourage participants to take the speed test
                    portion of this survey multiple times and on a periodic
                    basis to help us gauge the range and averages of performance
                    over time.
                  </p>

                  <p>Two things to ensure the most accurate test results:</p>
                  <ol>
                    <li>Minimizing the "noise" during an internet speed test, which is what the several tips above help you do, certainly contributes to a more
                      accurate speed test result.</li>
                    <li>Testing and retesting typically provide the best results</li>
                  </ol>

                  <p>
                    If you are seeing results that differ from other speed tests, the MLab <a
                      href="https://www.merit.edu/services/moonshot/rural-broadband-faqs/">FAQ</a> provides helpful information to help understand why.
                  </p>

                  <p>
                    Results are an accumlation of all MLab tests. Any test taken with an
                    MLab testing application (i.e. the speed test within Google search
                    resutls) will be presented in these results.
                  </p>

                  <p>
                    The results displayed are aggregated every 24 hours. Therefore, new survey data will not be immediately available.
                  </p>

                  <p>
                    For the most accurate test results:
                    If possible, connect to the Internet directly via a cable, DSL, or fiber modem
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-md-8 col-md-offset-2">
              <div id="ndt-results" class="ndt-related">
                <div class="container">
                  <div class="row">
                    <div class="col-md-3">
                      <div id="your-results" class="well">
                        <h3 class="league-gothic">{{ test_result_heading }}</h3>
                        <dl>
                          <dt>{{ download_result_label }}</dt>
                          <dd><span id="s2cRate" class="text-primary"></span> {{ download_result_unit }}</dd>

                          <dt>{{ upload_result_label }}</dt>
                          <dd><span id="c2sRate" class="text-primary"></span> {{ upload_result_unit }}</dd>

                          <dt>{{ rtt_result_label }}</dt>
                          <dd><span id="MinRTT" class="text-primary"></span> {{ rtt_result_unit }}</dd>
                        </dl>
                      </div>
                    </div>

                    <div class="col-md-9">
                      <div id="thankyou">
                        <h3 class="league-gothic">{{ thank_you_heading }}</h3>

                        <h4>{{ thank_you_message }}</h4>

                        <p>
                          Internet infrastructure and citizens’ use of it is
                          ever-evolving. A test conducted today may show different
                          results than a test conducted last week. This can be caused
                          by changes in equipment, the number of people using the
                          network simultaneously and the services people use on the
                          Internet.
                        </p>

                        <div class="panel panel-default">
                          <div class="panel-body">
                            <strong>
                              We encourage participants to take the speed test
                              portion of this survey multiple times and on a periodic
                              basis to help us gauge the range and averages of performance
                              over time.
                            </strong>
                          </div>
                        </div>

                        <h4>{{ next_action_message }}</h4>

                        <button type="button" class="btn btn-primary" id="retake-speed-test">Take the Speed Test Again</button>

                        <div id="socialshare">
                          <div>
                            <h4>Share On</h4>
                          </div>
                          <!-- Social Button HTML -->
                          {% if social_share_twitter is not none -%}
                          <!-- Twitter -->
                          <a href="{{ social_share_twitter }}" target=" _blank" class="share-btn twitter" aria-label="Share on Twitter">
                            <i class="fa fa-twitter"></i>
                          </a>
                          {% endif %}
                          {%- if social_share_facebook is not none -%}
                          <!-- Facebook -->
                          <a href="{{ social_share_facebook }}" target="_blank" class="share-btn facebook" aria-label="Share on Facebook">
                            <i class="fa fa-facebook"></i>
                          </a>
                          {% endif %}
                          {%- if social_share_linkedin is not none -%}
                          <!-- LinkedIn -->
                          <a href="{{ social_share_linkedin }}" target="_blank" class="share-btn linkedin" aria-label="Share on LinkedIn">
                            <i class="fa fa-linkedin"></i>
                          </a>
                          {% endif %}
                        </div>
                      </div> <!-- thankyou div -->
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </form>
      <div id="icons">
        <button type="button" class="btn btn-primary btn-lg" id="take-test" onclick="runTest()">{{ icon_test_label }}</button>
      </div>
    </div>
  </div>

  <script>
    var ndtServer,
      ndtServerIp,
      ndtPort = "3010",
      ndtProtocol = 'wss',
      ndtPath = "/ndt_protocol",
      ndtUpdateInterval = 1000,
      c2sRate,
      s2cRate,
      MinRTT;

    getNdtServer();

    uncheckAcknowledgement();

    NDT_meter = new NDTmeter('#ndt-svg');

    function handleStartEvents() {
      NDT_client = new NDTjs(ndtServer, ndtPort, ndtProtocol, ndtPath, NDT_meter, ndtUpdateInterval);
      NDT_client.startTest();
    }

    NDT_meter.meter.on("click", function (evt) {
      handleStartEvents();
    });

    /**
     * We can't consistently target SVG for events, so listen
     * to all of them and check the key and target.
     */
    $(window).on('keypress', function(evt) {
      var keyCodes = [13, 32];

      if ((evt.target == $('#ndt-svg svg')[0]) && (keyCodes.includes(evt.which))) {
        handleStartEvents();
      }
    });

    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(success, error);
    }

    $(document).ready(function (e) {
      $('#retake-speed-test').on('click', function (e) {
        let test_container_offset = $('#test-container').offset();
        window.scrollTo(test_container_offset.left, test_container_offset.top);

        $('#ndt-div').show();
        NDT_meter.reset_meter();
        NDT_client.startTest();
      });
    });

    function success(position) {

      document.getElementById('latitude').value = position.coords.latitude;
      document.getElementById('longitude').value = position.coords.longitude;

      var xhr = new XMLHttpRequest(),
        currentLocationURL = "https://nominatim.openstreetmap.org/reverse?format=json&lat=" + position.coords.latitude + "&lon=" + position.coords.longitude + "&zoom=18&addressdetails=1";

      var currentLoc;
      xhr.open('GET', currentLocationURL, true);
      xhr.send();
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            currentLoc = JSON.parse(xhr.responseText);
            console_log("Location received");

            // currentLocText.text(currentLoc.address.road + currentLoc.address.neighbourhood + currentLoc.address.suburb + currentLoc.address.city + currentLoc.address.state);
            $('#mobile-container').append('<div id="mobile-approx-loc"></div>')
            $('#approx-loc, #mobile-approx-loc').append("<p>Searching from:</p><p>" + currentLoc.address.road + ", " + currentLoc.address.city + ", " + currentLoc.address.state + "</p>");
          } else {
            console_log('Location lookup failed');
          }
        }
      };
    }

    function error(error) {
      // For some users, errors are thrown when they (or their browser, automatically) deny
      // geolocation. We should update this to properly present/report this and other errors.
      //document.getElementById('msg').innerHTML = 'ERROR(' + error.code + '): ' + error.message;
    }

    function getNdtServer() {
      var xhr = new XMLHttpRequest(),
        mlabNsUrl = 'https://mlab-ns.appspot.com/ndt_ssl?format=json';

      xhr.open('GET', mlabNsUrl, true);
      xhr.send();
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            ndtServer = JSON.parse(xhr.responseText).fqdn;
            ndtServerIp = JSON.parse(xhr.responseText).ip;
            console_log('Using M-Lab Server ' + ndtServer);
          } else {
            console_log('M-Lab NS lookup failed.');
          }
        }
      };
    };
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key={{ google_api_key }}&libraries=places&callback=initAutocomplete" async defer></script>
  <script src="/js/google-places.js"></script>
</body>

</html>
